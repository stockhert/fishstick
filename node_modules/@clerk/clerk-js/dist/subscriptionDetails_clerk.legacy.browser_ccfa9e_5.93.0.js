"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["965"],{51367:function(e,t,i){i.r(t),i.d(t,{SubscriptionDetails:()=>v}),i(92037),i(65223),i(38062),i(50725);var n=i(74328),a=i(83799),l=i(69144),o=i(13559),r=i(1677),c=i(29629),s=i(48216),u=i(2672),d=i(81102),p=i(28e3),m=i(33009),b=i(88870),y=i(39082),h=i(11576),D=i(64204),g=i(95746);let S=l.createContext({confirmationOpen:!1,setConfirmationOpen:()=>{},subscription:null,setSubscription:()=>{}}),v=e=>(0,n.tZ)(D.Flow.Root,{flow:"subscriptionDetails",children:(0,n.tZ)(D.Flow.Part,{children:(0,n.tZ)(d.Drawer.Content,{children:(0,n.tZ)(r.I.Provider,{value:{componentName:"SubscriptionDetails",...e},children:(0,n.tZ)(h.SubscriberTypeContext.Provider,{value:e.for,children:(0,n.tZ)(f,{...e})})})})})});function x(e){let{subscriptionItems:t,isLoading:i}=(0,h.useSubscription)(),n=null==t?void 0:t.find(e=>"active"===e.status),a=null==t?void 0:t.find(e=>"upcoming"===e.status),l=null==t?void 0:t.find(e=>"past_due"===e.status);if((null==e?void 0:e.or)==="throw"&&!n&&!l)throw Error("No active or past due subscription found");return{upcomingSubscription:a,pastDueSubscription:l,activeSubscription:n,anySubscription:a||n||l,isLoading:i}}let f=e=>{let[t,i]=(0,l.useState)(null),[a,o]=(0,l.useState)(!1),{subscriptionItems:r,isLoading:c}=(0,h.useSubscription)(),{activeSubscription:s,pastDueSubscription:u}=x();return c?(0,n.tZ)(D.Spinner,{sx:{margin:"auto"}}):s||u?(0,n.BX)(S.Provider,{value:{subscription:t,setSubscription:i,confirmationOpen:a,setConfirmationOpen:o},children:[(0,n.tZ)(d.Drawer.Header,{title:(0,D.localizationKeys)("commerce.subscriptionDetails.title")}),(0,n.tZ)(d.Drawer.Body,{sx:e=>({display:"flex",flexDirection:"column",flex:1,overflowY:"auto",padding:e.space.$4,gap:e.space.$4}),children:null==r?void 0:r.map(t=>(0,n.tZ)(K,{subscription:t,...e},t.id))}),(0,n.tZ)(z,{})]}):null},z=(0,u.withCardStateProvider)(()=>{let e=(0,h.useSubscriberTypeContext)(),{organization:t}=(0,a.o8)(),{isLoading:i,error:o,setError:c,setLoading:p,setIdle:m}=(0,u.useCardState)(),{subscription:y,confirmationOpen:g,setConfirmationOpen:v}=(0,l.useContext)(S),{data:x}=(0,h.useSubscription)(),{setIsOpen:f}=(0,d.useDrawerContext)(),{onSubscriptionCancel:z}=(0,r.F)(),Z=(0,l.useCallback)(e=>v(e),[v]),K=(0,l.useCallback)(async()=>{y&&(c(void 0),p(),await y.cancel({orgId:"organization"===e?null==t?void 0:t.id:void 0}).then(()=>{null==z||z(),f&&f(!1)}).catch(e=>{(0,b.S3)(e,[],c)}).finally(()=>{m()}))},[y,c,p,e,null==t?void 0:t.id,z,f,m]);return(null==x?void 0:x.nextPayment)?(0,n.BX)(d.Drawer.Footer,{children:[(0,n.tZ)(C,{}),(0,n.tZ)(d.Drawer.Confirmation,{open:g,onOpenChange:Z,actionsSlot:(0,n.BX)(n.HY,{children:[!i&&(0,n.tZ)(D.Button,{variant:"ghost",size:"sm",textVariant:"buttonLarge",onClick:()=>{m(),c(void 0),Z(!1)},localizationKey:(null==y?void 0:y.isFreeTrial)?(0,D.localizationKeys)("commerce.keepFreeTrial"):(0,D.localizationKeys)("commerce.keepSubscription")}),(0,n.tZ)(D.Button,{variant:"solid",colorScheme:"danger",size:"sm",textVariant:"buttonLarge",isLoading:i,onClick:()=>void K(),localizationKey:(null==y?void 0:y.isFreeTrial)?(0,D.localizationKeys)("commerce.cancelFreeTrial",{plan:y.plan.name}):(0,D.localizationKeys)("commerce.cancelSubscription")})]}),children:y?(0,n.BX)(n.HY,{children:[(0,n.tZ)(D.Heading,{elementDescriptor:D.descriptors.drawerConfirmationTitle,as:"h2",textVariant:"h3",localizationKey:(null==y?void 0:y.isFreeTrial)?(0,D.localizationKeys)("commerce.cancelFreeTrialTitle",{plan:y.plan.name}):(0,D.localizationKeys)("commerce.cancelSubscriptionTitle",{plan:"".concat("upcoming"===y.status?"upcoming ":"").concat(y.plan.name)})}),(0,n.tZ)(D.Text,{elementDescriptor:D.descriptors.drawerConfirmationDescription,colorScheme:"secondary",localizationKey:(null==y?void 0:y.isFreeTrial)?(0,D.localizationKeys)("commerce.cancelFreeTrialAccessUntil",{plan:y.plan.name,date:y.periodEnd}):"upcoming"===y.status?(0,D.localizationKeys)("commerce.cancelSubscriptionNoCharge"):(0,D.localizationKeys)("commerce.cancelSubscriptionAccessUntil",{plan:y.plan.name,date:y.periodEnd})}),(0,n.tZ)(s.m,{children:o})]}):null})]}):null});function C(){let{activeSubscription:e}=x({or:"throw"}),{data:t}=(0,h.useSubscription)();if(!(null==t?void 0:t.nextPayment)||!e)return null;let{isFreeTrial:i}=e;return(0,n.BX)(p.a.Root,{children:[(0,n.BX)(p.a.Group,{children:[(0,n.tZ)(p.a.Title,{description:(0,D.localizationKeys)("commerce.subscriptionDetails.currentBillingCycle")}),(0,n.tZ)(p.a.Description,{text:"month"===e.planPeriod?(0,D.localizationKeys)("commerce.monthly"):(0,D.localizationKeys)("commerce.annually")})]}),(0,n.BX)(p.a.Group,{children:[(0,n.tZ)(p.a.Title,{description:(0,D.localizationKeys)("commerce.subscriptionDetails.".concat(i?"firstPaymentOn":"nextPaymentOn"))}),(0,n.tZ)(p.a.Description,{text:(0,y.p)(t.nextPayment.date)})]}),(0,n.BX)(p.a.Group,{children:[(0,n.tZ)(p.a.Title,{description:(0,D.localizationKeys)("commerce.subscriptionDetails.".concat(i?"firstPaymentAmount":"nextPaymentAmount"))}),(0,n.tZ)(p.a.Description,{prefix:t.nextPayment.amount.currency,text:"".concat(t.nextPayment.amount.currencySymbol).concat(t.nextPayment.amount.amountFormatted)})]})]})}let Z=e=>{let{subscription:t}=e,{portalRoot:i}=(0,r.F)(),{__internal_openCheckout:c}=(0,a.cL)(),s=(0,h.useSubscriberTypeContext)(),{setIsOpen:u}=(0,d.useDrawerContext)(),{revalidateAll:p}=(0,h.usePlansContext)(),{setSubscription:b,setConfirmationOpen:y}=(0,l.useContext)(S),g=(0,o.N2)(e=>e({permission:"org:sys_billing:manage"})),v="user"===s||g,x=("month"===t.planPeriod&&t.plan.annualMonthlyFee.amount>0||"annual"===t.planPeriod)&&"past_due"!==t.status,f=!t.plan.hasBaseFee,z=null===t.canceledAt&&!f&&"past_due"!==t.status,C=null!==t.canceledAt&&!f,Z=(0,l.useCallback)(e=>{u&&u(!1),c({...e,onSubscriptionComplete:()=>{p()},portalRoot:i})},[c,p,i,u]),K=l.useMemo(()=>v?[x?{label:"month"===t.planPeriod?(0,D.localizationKeys)("commerce.switchToAnnualWithAnnualPrice",{price:(0,h.normalizeFormatted)(t.plan.annualFee.amountFormatted),currency:t.plan.annualFee.currencySymbol}):(0,D.localizationKeys)("commerce.switchToMonthlyWithPrice",{price:(0,h.normalizeFormatted)(t.plan.fee.amountFormatted),currency:t.plan.fee.currencySymbol}),onClick:()=>{Z({planId:t.plan.id,planPeriod:"month"===t.planPeriod?"annual":"month",for:s})}}:null,z?{isDestructive:!0,label:t.isFreeTrial?(0,D.localizationKeys)("commerce.cancelFreeTrial",{plan:t.plan.name}):(0,D.localizationKeys)("commerce.cancelSubscription"),onClick:()=>{b(t),y(!0)}}:null,C?{label:(0,D.localizationKeys)("commerce.reSubscribe"),onClick:()=>{Z({planId:t.plan.id,planPeriod:t.planPeriod,for:s})}}:null].filter(e=>null!==e):[],[x,t,z,Z,s,b,v,C,y]);return 0===K.length?null:(0,n.tZ)(m.a,{variant:"bordered",actions:K})},K=e=>{let{subscription:t}=e,{t:i}=(0,D.useLocalizations)(),a="month"===t.planPeriod?t.plan.fee:t.plan.annualFee;return(0,n.BX)(D.Col,{elementDescriptor:D.descriptors.subscriptionDetailsCard,sx:e=>({borderRadius:e.radii.$md,boxShadow:e.shadows.$tableBodyShadow}),children:[(0,n.BX)(D.Col,{elementDescriptor:D.descriptors.subscriptionDetailsCardBody,gap:3,sx:e=>({padding:e.space.$3}),children:[(0,n.BX)(D.Flex,{elementDescriptor:D.descriptors.subscriptionDetailsCardHeader,align:"center",gap:2,children:[t.plan.avatarUrl?(0,n.tZ)(c.q,{boxElementDescriptor:D.descriptors.planDetailAvatar,size:e=>40,title:t.plan.name,rounded:!1,imageUrl:t.plan.avatarUrl}):null,(0,n.tZ)(D.Text,{elementDescriptor:D.descriptors.subscriptionDetailsCardTitle,variant:"h2",sx:e=>({fontSize:e.fontSizes.$lg,fontWeight:e.fontWeights.$semibold,color:e.colors.$colorForeground,marginInlineEnd:"auto"}),children:t.plan.name}),(0,n.tZ)(g.u,{subscription:t.isFreeTrial?{status:"free_trial"}:t,elementDescriptor:D.descriptors.subscriptionDetailsCardBadge})]}),(0,n.BX)(D.Flex,{elementDescriptor:D.descriptors.subscriptionDetailsCardActions,justify:"between",align:"center",children:[(0,n.BX)(D.Text,{variant:"body",colorScheme:"secondary",sx:e=>({fontWeight:e.fontWeights.$medium,textTransform:"lowercase"}),children:[a.currencySymbol,a.amountFormatted," /"," ",i((0,D.localizationKeys)("commerce.".concat("month"===t.planPeriod?"month":"year")))]}),(0,n.tZ)(Z,{subscription:t})]})]}),t.pastDueAt?(0,n.tZ)(T,{label:(0,D.localizationKeys)("commerce.subscriptionDetails.pastDueAt"),value:(0,y.p)(t.pastDueAt)}):null,"active"===t.status?(0,n.BX)(n.HY,{children:[(0,n.tZ)(T,{label:t.isFreeTrial?(0,D.localizationKeys)("commerce.subscriptionDetails.trialStartedOn"):(0,D.localizationKeys)("commerce.subscriptionDetails.subscribedOn"),value:(0,y.p)(t.createdAt)}),t.periodEnd&&(0,n.tZ)(T,{label:t.canceledAt?(0,D.localizationKeys)("commerce.subscriptionDetails.endsOn"):t.isFreeTrial?(0,D.localizationKeys)("commerce.subscriptionDetails.trialEndsOn"):(0,D.localizationKeys)("commerce.subscriptionDetails.renewsAt"),value:(0,y.p)(t.periodEnd)})]}):null,"upcoming"===t.status?(0,n.tZ)(T,{label:(0,D.localizationKeys)("commerce.subscriptionDetails.beginsOn"),value:(0,y.p)(t.periodStart)}):null]})},T=e=>{let{label:t,value:i}=e;return(0,n.BX)(D.Flex,{elementDescriptor:D.descriptors.subscriptionDetailsDetailRow,justify:"between",align:"center",sx:e=>({paddingInline:e.space.$3,paddingBlock:e.space.$3,borderBlockStartWidth:e.borderWidths.$normal,borderBlockStartStyle:e.borderStyles.$solid,borderBlockStartColor:e.colors.$borderAlpha100}),children:[(0,n.tZ)(D.Text,{elementDescriptor:D.descriptors.subscriptionDetailsDetailRowLabel,localizationKey:t}),(0,n.tZ)(D.Text,{elementDescriptor:D.descriptors.subscriptionDetailsDetailRowValue,colorScheme:"secondary",children:i})]})}},95746:function(e,t,i){i.d(t,{u:()=>r});var n=i(74328),a=i(64204);let l={active:"badge__activePlan",upcoming:"badge__upcomingPlan",past_due:"badge__pastDuePlan",free_trial:"badge__freeTrial"},o={active:"secondary",upcoming:"primary",past_due:"warning",free_trial:"secondary"},r=e=>{let{subscription:t,elementDescriptor:i}=e;return(0,n.tZ)(a.Badge,{elementDescriptor:i,colorScheme:o[t.status],localizationKey:(0,a.localizationKeys)(l[t.status])})}}}]);