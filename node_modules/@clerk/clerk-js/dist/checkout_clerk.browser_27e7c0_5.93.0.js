"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{670:function(e,t,r){r.r(t),r.d(t,{Checkout:()=>G});var o=r(4328),i=r(1102),a=r(1576),n=r(4204),l=r(3799),c=r(9144),s=r(8e3),d=r(9082),u=r(3003),m=r(6352),p=r(4676);let h=e=>e[0].toUpperCase()+e.slice(1),f=(e,t,r)=>e+(t-e)*r,y=()=>{let e=(0,p.useRouter)(),{setIsOpen:t}=(0,i.useDrawerContext)(),{newSubscriptionRedirectUrl:r}=(0,a.useCheckoutContext)(),{checkout:y}=(0,l.z4)(),{totals:g,paymentSource:x,planPeriodStart:b,freeTrialEndsAt:Z}=y,[$,S]=(0,c.useState)({x:256,y:256}),[k,B]=(0,c.useState)({x:256,y:256}),w=(0,c.useId)(),v=(0,c.useId)(),z=(0,c.useId)(),_=(0,m.Tb)(),{animations:D}=(0,n.useAppearance)().parsedLayout,C=!_&&!0===D,K=(0,c.useRef)(null),P=(0,c.useRef)(null),R="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;return((0,c.useEffect)(()=>{if(!R)return;let e=()=>{B(e=>({x:f(e.x,$.x,.15),y:f(e.y,$.y,.15)})),K.current=requestAnimationFrame(e)};return K.current=requestAnimationFrame(e),()=>{K.current&&cancelAnimationFrame(K.current)}},[$,R]),g)?(0,o.BX)(o.HY,{children:[(0,o.tZ)(i.Drawer.Body,{children:(0,o.BX)(n.Span,{elementDescriptor:n.descriptors.checkoutSuccessRoot,sx:e=>({"--ring-fill":e.colors.$neutralAlpha200,"--ring-highlight":e.colors.$success500,margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",flexShrink:0,transformOrigin:"bottom center",animationName:"scaleIn",animationDuration:`${u.bf.slowest}ms`,animationTimingFunction:u.$$.bezier,animationFillMode:"forwards",opacity:0,overflow:"hidden",backgroundColor:e.colors.$colorBackground,"@keyframes scaleIn":{"0%":{filter:"blur(10px)",transform:"scale(0.85)",opacity:0},"100%":{filter:"blur(0px)",transform:"scale(1)",opacity:1}},...!C&&{animation:"none",opacity:1}}),ref:P,onMouseMove:e=>{if(R&&P.current){let t=P.current.getBoundingClientRect(),r=e.clientX-t.left,o=e.clientY-t.top,i=t.width;i>0?S({x:r/i*512,y:o/i*512}):S({x:256,y:256})}},children:[(0,o.BX)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessRings,as:"svg",viewBox:"0 0 512 512",sx:{position:"absolute",inset:0,pointerEvents:"none"},"aria-hidden":!0,children:[(0,o.BX)("defs",{children:[(0,o.BX)("radialGradient",{id:"clerk-checkout-success-gradient",children:[(0,o.tZ)("stop",{offset:"0%",style:{stopColor:"var(--ring-highlight)"}}),(0,o.tZ)("stop",{offset:"100%",stopOpacity:"0",style:{stopColor:"var(--ring-highlight)"}})]}),(0,o.tZ)("filter",{id:"clerk-checkout-success-blur-effect",children:(0,o.tZ)("feGaussianBlur",{stdDeviation:"10"})}),[{r:225,maskStart:10,maskEnd:90,id:w},{r:162.5,maskStart:15,maskEnd:85,id:v},{r:100,maskStart:20,maskEnd:80,id:z}].map(({maskStart:e,maskEnd:t,id:r})=>(0,o.BX)("linearGradient",{id:`gradient-${r}`,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[(0,o.tZ)("stop",{offset:`${e+5}%`,stopColor:"white",stopOpacity:"0"}),(0,o.tZ)("stop",{offset:`${e+35}%`,stopColor:"white",stopOpacity:"1"}),(0,o.tZ)("stop",{offset:`${t-35}%`,stopColor:"white",stopOpacity:"1"}),(0,o.tZ)("stop",{offset:`${t-5}%`,stopColor:"white",stopOpacity:"0"})]},r)),(0,o.tZ)("mask",{id:"clerk-checkout-success-mask",children:[{r:225,id:w},{r:162.5,id:v},{r:100,id:z}].map(({r:e,id:t})=>(0,o.tZ)("circle",{cx:"256",cy:"256",r:e,stroke:`url(#gradient-${t})`,fill:"none",strokeWidth:"1"},t))})]}),(0,o.BX)("g",{mask:"url(#clerk-checkout-success-mask)",children:[(0,o.tZ)("rect",{width:"512",height:"512",style:{fill:"var(--ring-fill)"}}),R&&(0,o.tZ)("rect",{id:"movingGradientHighlight",width:"256",height:"256",x:k.x-128,y:k.y-128,fill:"url(#clerk-checkout-success-gradient)",filter:"url(#clerk-checkout-success-blur-effect)"})]})]}),(0,o.BX)(n.Box,{elementDescriptor:n.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",color:R?e.colors.$success500:e.colors.$colorForeground,":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:[(0,o.tZ)("svg",{fill:"none",viewBox:"0 0 10 10","aria-hidden":"true",style:{position:"relative",margin:"auto",width:"1rem",height:"1rem"},children:(0,o.tZ)("path",{d:"m1 6 3 3 5-8",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"1",pathLength:"1",style:{strokeDashoffset:"1",animation:C?`check ${u.bf.drawer}ms ${u.$$.bezier} forwards ${u.bf.slow}ms`:"none",...!C&&{strokeDashoffset:"0"}}})}),(0,o.tZ)("style",{children:`
              @keyframes check {
                0% {
                  stroke-dashoffset: 1;
                }
                100% {
                  stroke-dashoffset: 0;
                }
            `})]}),(0,o.BX)(n.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:`translateY(${e.space.$20})`}),children:[(0,o.tZ)(n.Heading,{elementDescriptor:n.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:Z?(0,n.localizationKeys)("commerce.checkout.title__trialSuccess"):g.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.title__paymentSuccessful"):(0,n.localizationKeys)("commerce.checkout.title__subscriptionSuccessful"),sx:e=>({opacity:0,animationName:"slideUp",animationDuration:`${u.bf.slowest}ms`,animationTimingFunction:u.$$.bezier,animationFillMode:"forwards",color:e.colors.$colorForeground,"@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!C&&{opacity:1,animation:"none"}})}),(0,o.tZ)(n.Text,{elementDescriptor:n.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2,opacity:0,animationName:"slideUp",animationDuration:`${1.5*u.bf.slowest}ms`,animationTimingFunction:u.$$.bezier,animationFillMode:"forwards","@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!C&&{opacity:1,animation:"none"}}),localizationKey:g.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.checkout.description__paymentSuccessful"):(0,n.localizationKeys)("commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,o.BX)(i.Drawer.Footer,{sx:e=>({rowGap:e.space.$4,animationName:"footerSlideInUp",animationDuration:`${u.bf.drawer}ms`,animationTimingFunction:u.$$.bezier,"@keyframes footerSlideInUp":{"0%":{transform:"translateY(100%)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!C&&{animation:"none"}}),children:[(0,o.BX)(s.a.Root,{children:[(0,o.BX)(s.a.Group,{variant:"secondary",children:[(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.checkout.lineItems.title__totalPaid")}),(0,o.tZ)(s.a.Description,{text:`${g.totalDueNow.currencySymbol}${g.totalDueNow.amountFormatted}`})]}),Z?(0,o.BX)(s.a.Group,{variant:"secondary",children:[(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.checkout.lineItems.title__freeTrialEndsAt")}),(0,o.tZ)(s.a.Description,{text:(0,d.p)(Z)})]}):null,(0,o.BX)(s.a.Group,{variant:"secondary",children:[(0,o.tZ)(s.a.Title,{title:g.totalDueNow.amount>0||null!==Z?(0,n.localizationKeys)("commerce.checkout.lineItems.title__paymentMethod"):(0,n.localizationKeys)("commerce.checkout.lineItems.title__subscriptionBegins")}),(0,o.tZ)(s.a.Description,{text:g.totalDueNow.amount>0||null!==Z?x?"card"!==x.paymentMethod?`${h(x.paymentMethod)}`:`${h(x.cardType)} \u{22EF} ${x.last4}`:"–":b?(0,d.p)(new Date(b)):"–"})]})]}),(0,o.tZ)(n.Button,{onClick:()=>{r&&e.navigate(r),t&&t(!1)},localizationKey:(0,n.localizationKeys)("formButtonPrimary")})]})]}):null};var g=r(2418),x=r(2672),b=r(7291),Z=r(3146),$=r(9732),S=r(8870),k=r(2189),B=r(4174),w=r(5058),v=r(7106),z=r(5746);let _=e=>e[0].toUpperCase()+e.slice(1),D=(0,x.withCardStateProvider)(()=>{let{checkout:e}=(0,l.z4)(),{id:t,plan:r,totals:a,isImmediatePlanChange:c,planPeriod:d,freeTrialEndsAt:u}=e;if(!t)return null;let m=!!a.credit?.amount&&a.credit.amount>0,p=!!a.pastDue?.amount&&a.pastDue.amount>0,h="month"===d?r.fee:r.annualMonthlyFee;return(0,o.BX)(i.Drawer.Body,{children:[(0,o.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$borderAlpha100}),children:(0,o.BX)(s.a.Root,{children:[(0,o.BX)(s.a.Group,{children:[(0,o.tZ)(s.a.Title,{title:r.name,description:"annual"===d?(0,n.localizationKeys)("commerce.billedAnnually"):void 0,badge:r.freeTrialEnabled&&u?(0,o.tZ)(z.u,{subscription:{status:"free_trial"}}):null}),(0,o.tZ)(s.a.Description,{prefix:"annual"===d?"x12":void 0,text:`${h.currencySymbol}${h.amountFormatted}`,suffix:(0,n.localizationKeys)("commerce.checkout.perMonth")})]}),(0,o.BX)(s.a.Group,{borderTop:!0,variant:"tertiary",children:[(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.subtotal")}),(0,o.tZ)(s.a.Description,{text:`${a.subtotal.currencySymbol}${a.subtotal.amountFormatted}`})]}),m&&(0,o.BX)(s.a.Group,{variant:"tertiary",children:[(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.creditRemainder")}),(0,o.tZ)(s.a.Description,{text:`- ${a.credit?.currencySymbol}${a.credit?.amountFormatted}`})]}),p&&(0,o.BX)(s.a.Group,{variant:"tertiary",children:[(0,o.BX)($.u.Root,{children:[(0,o.tZ)($.u.Trigger,{children:(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.pastDue"),icon:B.I$})}),(0,o.tZ)($.u.Content,{text:(0,n.localizationKeys)("commerce.checkout.pastDueNotice")})]}),(0,o.tZ)(s.a.Description,{text:`${a.pastDue?.currencySymbol}${a.pastDue?.amountFormatted}`})]}),!!u&&!!r.freeTrialDays&&(0,o.BX)(s.a.Group,{variant:"tertiary",children:[(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.checkout.totalDueAfterTrial",{days:r.freeTrialDays})}),(0,o.tZ)(s.a.Description,{text:`${a.grandTotal?.currencySymbol}${a.grandTotal?.amountFormatted}`})]}),(0,o.BX)(s.a.Group,{borderTop:!0,children:[(0,o.tZ)(s.a.Title,{title:(0,n.localizationKeys)("commerce.totalDueToday")}),(0,o.tZ)(s.a.Description,{text:`${a.totalDueNow.currencySymbol}${a.totalDueNow.amountFormatted}`})]})]})}),!c&&(0,o.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({paddingBlockStart:e.space.$4,paddingInline:e.space.$4}),children:(0,o.tZ)(n.Text,{localizationKey:(0,n.localizationKeys)("commerce.checkout.downgradeNotice"),variant:"caption",colorScheme:"secondary"})}),(0,o.tZ)(K,{})]})}),C=()=>{let{for:e,onSubscriptionComplete:t}=(0,a.useCheckoutContext)(),{checkout:r}=(0,l.z4)(),{id:o,confirm:i}=r,n=(0,x.useCardState)();if(!o)throw Error("Checkout not found");let c=async e=>{n.setLoading(),n.setError(void 0);let{data:r,error:o}=await i(e);o?(0,S.S3)(o,[],n.setError):r&&t?.(),n.setIdle()};return{payWithExistingPaymentSource:e=>(e.preventDefault(),c({paymentSourceId:new FormData(e.currentTarget).get("payment_source_id")})),addPaymentSourceAndPay:e=>c(e),payWithTestCard:()=>c({gateway:"stripe",useTestCard:!0})}},K=()=>{let{checkout:e}=(0,l.z4)(),{id:t,totals:r,freeTrialEndsAt:i}=e,{data:s}=(0,a.usePaymentMethods)(),[d,u]=(0,c.useState)(()=>s.length>0?"existing":"new");return t?(0,o.BX)(n.Col,{elementDescriptor:n.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[s.length>0&&(r.totalDueNow.amount>0||!!i)&&(0,o.BX)(b.s.Root,{"aria-label":"Payment method source",value:d,onChange:e=>u(e),size:"lg",fullWidth:!0,children:[(0,o.tZ)(b.s.Button,{value:"existing",text:(0,n.localizationKeys)("commerce.paymentMethods")}),(0,o.tZ)(b.s.Button,{value:"new",text:(0,n.localizationKeys)("commerce.addPaymentMethod")})]}),"existing"===d&&(0,o.tZ)(A,{paymentSources:s,totalDueNow:r.totalDueNow}),"new"===d&&(0,o.tZ)(T,{})]}):null},P=()=>{let{isLoading:e}=(0,x.useCardState)(),{payWithTestCard:t}=C();return(0,o.BX)(n.Box,{sx:e=>({background:e.colors.$neutralAlpha50,padding:e.space.$2x5,borderRadius:e.radii.$md,borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$borderAlpha100,display:"flex",flexDirection:"column",rowGap:e.space.$2,position:"relative"}),children:[(0,o.tZ)(n.Box,{sx:e=>({position:"absolute",inset:0,background:`repeating-linear-gradient(-45deg,${e.colors.$warningAlpha100},${e.colors.$warningAlpha100} 6px,${e.colors.$warningAlpha150} 6px,${e.colors.$warningAlpha150} 12px)`,maskImage:"linear-gradient(transparent 20%, black)",pointerEvents:"none"})}),(0,o.BX)(n.Flex,{sx:e=>({alignItems:"center",justifyContent:"center",flexDirection:"column",rowGap:e.space.$2}),children:[(0,o.tZ)(n.Text,{sx:e=>({color:e.colors.$warning500,fontWeight:e.fontWeights.$semibold}),localizationKey:(0,n.localizationKeys)("commerce.paymentSource.dev.developmentMode")}),(0,o.tZ)(n.Button,{type:"button",block:!0,variant:"bordered",localizationKey:(0,n.localizationKeys)("userProfile.billingPage.paymentSourcesSection.payWithTestCardButton"),colorScheme:"secondary",isLoading:e,onClick:t})]})]})},R=()=>{let{checkout:e}=(0,l.z4)(),{status:t,freeTrialEndsAt:r,totals:o}=e;if("needs_initialization"===t)throw Error("Clerk: Invalid state");return r?(0,n.localizationKeys)("commerce.startFreeTrial"):o.totalDueNow.amount>0?(0,n.localizationKeys)("commerce.pay",{amount:`${o.totalDueNow.currencySymbol}${o.totalDueNow.amountFormatted}`}):(0,n.localizationKeys)("commerce.subscribe")},T=(0,x.withCardStateProvider)(()=>{let{addPaymentSourceAndPay:e}=C(),t=R(),{checkout:r}=(0,l.z4)();return(0,o.BX)(w.fC,{onSuccess:e,checkout:r,children:[(0,o.tZ)(k.P,{children:(0,o.tZ)(P,{})}),(0,o.tZ)(w.OL,{text:t})]})}),A=(0,x.withCardStateProvider)(({totalDueNow:e,paymentSources:t})=>{let r=R(),{checkout:i}=(0,l.z4)(),{paymentSource:a,freeTrialEndsAt:s}=i,{payWithExistingPaymentSource:d}=C(),u=(0,x.useCardState)(),[m,p]=(0,c.useState)(a||t.find(e=>e.isDefault)),h=(0,c.useMemo)(()=>t.map(e=>{let t="card"!==e.paymentMethod?`${_(e.paymentMethod)}`:`${_(e.cardType)} \u{22EF} ${e.last4}`;return{value:e.id,label:t}}),[t]),f=0===e.amount||!s;return(0,o.BX)(n.Form,{onSubmit:d,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[f?(0,o.BX)(Z.Ph,{elementId:"paymentSource",options:h,value:m?.id||null,onChange:e=>{p(t.find(t=>t.id===e.value))},portal:!0,children:[(0,o.tZ)("input",{name:"payment_source_id",type:"hidden",value:m?.id}),(0,o.tZ)(Z.UN,{icon:B.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:m&&(0,o.tZ)(v.j,{paymentSource:m})}),(0,o.tZ)(Z.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorForeground})})]}):(0,o.tZ)("input",{name:"payment_source_id",type:"hidden",value:m?.id}),(0,o.tZ)(g.Z.Alert,{children:u.error}),(0,o.tZ)(n.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:u.isLoading,localizationKey:r})]})});var X=r(8018);let F=()=>{let{checkout:e}=(0,l.z4)();return(0,c.useEffect)(()=>(e.start(),e.clear),[]),null},I=({children:e})=>{let{planId:t,planPeriod:r,for:i}=(0,X.w6)();return(0,o.BX)(l.hA,{for:i,planId:t,planPeriod:r,children:[(0,o.tZ)(F,{}),e]})},E=({children:e,name:t})=>{let{checkout:r}=(0,l.z4)();return r.status!==t?null:e},L=({children:e,status:t})=>{let{checkout:r}=(0,l.z4)(),{fetchStatus:o,error:i}=r;return(0,c.useMemo)(()=>{if("error"===o){let e=i.errors.map(e=>e.code);if(e.includes("missing_payer_email"))return"missing_payer_email";if(e.includes("invalid_plan_change"))return"invalid_plan_change"}return o},[o])!==t?null:e};var M=r(9117),j=r(9140);let N=()=>{let{checkout:e}=(0,l.z4)(),{translateError:t}=(0,n.useLocalizations)(),{t:r}=(0,n.useLocalizations)();return(0,o.tZ)(i.Drawer.Body,{children:(0,o.tZ)(n.Flex,{align:"center",justify:"center",sx:e=>({height:"100%",padding:e.space.$4,fontSize:e.fontSizes.$md}),children:(0,o.tZ)(M.b,{variant:"danger",colorScheme:"danger",children:e.error?t(e.error.errors[0]):r((0,n.localizationKeys)("unstable__errors.form_param_value_invalid"))})})})},U=()=>{let{planPeriod:e}=(0,a.useCheckoutContext)(),{checkout:t}=(0,l.z4)(),r=t.error,d=(0,c.useMemo)(()=>{let e=r?.errors.find(e=>"invalid_plan_change"===e.code);return e?.meta?.plan},[r]),u=(0,c.useMemo)(()=>{let e=r?.errors.find(e=>"invalid_plan_change"===e.code);return e?.meta?.isPlanUpgradePossible||!1},[r]);return d?(0,o.tZ)(i.Drawer.Body,{children:(0,o.BX)(n.Flex,{gap:4,direction:"col",children:[(0,o.tZ)(n.Box,{elementDescriptor:n.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$borderAlpha100}),children:(0,o.tZ)(s.a.Root,{children:(0,o.BX)(s.a.Group,{children:[(0,o.tZ)(s.a.Title,{title:d.name,description:"annual"===e?(0,n.localizationKeys)("commerce.billedAnnually"):void 0}),(0,o.tZ)(s.a.Description,{prefix:"annual"===e?"x12":void 0,text:`${d.currency_symbol}${"month"===e?d.amount_formatted:d.annual_monthly_amount_formatted}`,suffix:(0,n.localizationKeys)("commerce.checkout.perMonth")})]})})}),(0,o.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,o.tZ)(M.b,{variant:"info",colorScheme:"info",title:u?(0,n.localizationKeys)("commerce.cannotSubscribeMonthly"):(0,n.localizationKeys)("commerce.cannotSubscribeUnrecoverable")})})]})}):null},W=()=>{let{checkout:e}=(0,l.z4)(),{setIsOpen:t}=(0,i.useDrawerContext)();return(0,o.tZ)(i.Drawer.Body,{children:(0,o.tZ)(n.Box,{sx:e=>({padding:e.space.$4}),children:(0,o.tZ)(j._,{title:(0,n.localizationKeys)("commerce.checkout.emailForm.title"),subtitle:(0,n.localizationKeys)("commerce.checkout.emailForm.subtitle"),onSuccess:()=>void e.start(),onReset:()=>t(!1),disableAutoFocus:!0})})})},G=e=>(0,o.tZ)(n.Flow.Root,{flow:"checkout",children:(0,o.tZ)(n.Flow.Part,{children:(0,o.tZ)(a.SubscriberTypeContext.Provider,{value:e.for||"user",children:(0,o.tZ)(a.CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,o.BX)(i.Drawer.Content,{children:[(0,o.tZ)(i.Drawer.Header,{title:(0,n.localizationKeys)("commerce.checkout.title")}),(0,o.BX)(I,{children:[(0,o.BX)(E,{name:"needs_initialization",children:[(0,o.tZ)(L,{status:"fetching",children:(0,o.tZ)(n.Spinner,{sx:{margin:"auto"}})}),(0,o.tZ)(L,{status:"invalid_plan_change",children:(0,o.tZ)(U,{})}),(0,o.tZ)(L,{status:"missing_payer_email",children:(0,o.tZ)(W,{})}),(0,o.tZ)(L,{status:"error",children:(0,o.tZ)(N,{})})]}),(0,o.tZ)(E,{name:"completed",children:(0,o.tZ)(y,{})}),(0,o.tZ)(E,{name:"needs_confirmation",children:(0,o.tZ)(D,{})})]})]})})})})})},5058:function(e,t,r){r.d(t,{hG:()=>z,ph:()=>v,fC:()=>B,OL:()=>_});var o=r(4328),i=r(3799),a=r(9144),n=r(2418),l=r(2672),c=r(431),s=r(9460),d=r(8487),u=r(8849),m=r(8870),p=r(1576),h=r(4204);let f=e=>(0,o.tZ)(h.Box,{sx:[e=>({height:e.space.$2,width:"100%",borderRadius:e.radii.$md,background:e.colors.$neutralAlpha100}),e.sx]}),y=()=>(0,o.tZ)(f,{sx:e=>({height:e.space.$10,width:"100%"})}),g=e=>(0,o.tZ)(h.Flex,{direction:"col",gap:2,children:e.children}),x=()=>(0,o.tZ)(h.Box,{"aria-label":"Loading...",sx:{position:"relative",minHeight:0,flex:1,overflowY:"auto"},children:(0,o.BX)(h.Flex,{direction:"col",gap:5,children:[(0,o.BX)(g,{children:[(0,o.tZ)(f,{sx:e=>({height:e.space.$3,width:e.sizes.$24})}),(0,o.tZ)(y,{})]}),(0,o.BX)(h.Grid,{columns:2,gap:4,children:[(0,o.BX)(g,{children:[(0,o.tZ)(f,{sx:e=>({height:e.space.$3,width:e.sizes.$20})}),(0,o.tZ)(y,{})]}),(0,o.BX)(g,{children:[(0,o.tZ)(f,{sx:e=>({height:e.space.$3,width:e.sizes.$24})}),(0,o.tZ)(y,{})]})]}),(0,o.BX)(g,{children:[(0,o.tZ)(f,{sx:e=>({height:e.space.$3,width:e.sizes.$16})}),(0,o.tZ)(y,{})]}),(0,o.BX)(g,{children:[(0,o.tZ)(f,{}),(0,o.tZ)(f,{}),(0,o.tZ)(f,{sx:{width:"66.666667%"}})]})]})}),[b,Z]=(0,i.uH)("AddPaymentSourceRoot"),$=({children:e,checkout:t,...r})=>{let n=(0,p.useSubscriberTypeContext)(),l=(0,a.useRef)(null),{t:c}=(0,h.useLocalizations)(),[s,d]=(0,a.useState)(void 0),[m,f]=(0,a.useState)(void 0),[y,g]=(0,a.useState)(void 0),x=(e=>{let t=(0,h.useAppearance)().parsedInternalTheme;return(0,a.useMemo)(()=>{if(!e)return;let{colors:r,fontWeights:o,fontSizes:i,radii:a,space:n}=t;return{colorPrimary:(0,u.Aj)(e,r.$primary500,r.$colorBackground),colorBackground:(0,u.Aj)(e,r.$colorInput,r.$colorBackground),colorText:(0,u.Aj)(e,r.$colorForeground,r.$colorBackground),colorTextSecondary:(0,u.Aj)(e,r.$colorMutedForeground,r.$colorBackground),colorSuccess:(0,u.Aj)(e,r.$success500,r.$colorBackground),colorDanger:(0,u.Aj)(e,r.$danger500,r.$colorBackground),colorWarning:(0,u.Aj)(e,r.$warning500,r.$colorBackground),fontWeightNormal:(0,u.uj)(e,"font-weight",o.$normal.toString()),fontWeightMedium:(0,u.uj)(e,"font-weight",o.$medium.toString()),fontWeightBold:(0,u.uj)(e,"font-weight",o.$bold.toString()),fontSizeXl:(0,u.uj)(e,"font-size",i.$xl),fontSizeLg:(0,u.uj)(e,"font-size",i.$lg),fontSizeSm:(0,u.uj)(e,"font-size",i.$md),fontSizeXs:(0,u.uj)(e,"font-size",i.$sm),borderRadius:(0,u.uj)(e,"border-radius",a.$lg),spacingUnit:(0,u.uj)(e,"padding",n.$1)}},[t,e])})(l.current);return(0,o.BX)(b.Provider,{value:{value:{headerTitle:s,headerSubtitle:m,submitLabel:y,setHeaderTitle:d,setHeaderSubtitle:f,setSubmitLabel:g,checkout:t,...r}},children:[(0,o.tZ)("div",{ref:l,style:{display:"none"}}),(0,o.tZ)(i.pe,{checkout:t,for:n,stripeAppearance:x,paymentDescription:c((0,h.localizationKeys)(t?.planPeriod==="month"?"commerce.paymentSource.applePayDescription.monthly":"commerce.paymentSource.applePayDescription.annual")),children:e})]})},S=e=>{let{isProviderReady:t}=(0,i.Wh)();return t?null:e.children},k=e=>{let{isProviderReady:t}=(0,i.Wh)();return t?(0,o.tZ)(o.HY,{children:e.children}):null},B=e=>{let{children:t,...r}=e;return(0,o.BX)($,{...r,children:[(0,o.tZ)(S,{children:(0,o.tZ)(h.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({width:"100%",minHeight:e.sizes.$60}),children:(0,o.tZ)(h.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:h.descriptors.spinner})})}),(0,o.tZ)(k,{children:(0,o.tZ)(D,{children:t})})]})},w=(e,t)=>{(0,a.useRef)(()=>{t(e)}),(0,a.useEffect)(()=>{t(e)},[e,t])},v=({text:e})=>{let{setHeaderTitle:t}=Z();return w(e,t),null},z=({text:e})=>{let{setHeaderSubtitle:t}=Z();return w(e,t),null},_=({text:e})=>{let{setSubmitLabel:t}=Z();return w(e,t),null},D=({children:e})=>{let{headerTitle:t,headerSubtitle:r,submitLabel:a,checkout:u,onSuccess:f,cancelAction:y}=Z(),g=(0,l.useCardState)(),b=(0,p.useSubscriberTypeLocalizationRoot)(),{isFormReady:$,submit:S,reset:k}=(0,i.Wh)(),B=async e=>{e.preventDefault(),g.setLoading(),g.setError(void 0);let{data:t,error:r}=await S();if(!r)try{await f(t)}catch(e){(0,m.S3)(e,[],g.setError)}finally{g.setIdle(),k()}};return(0,o.tZ)(d.Y,{headerTitle:t,headerSubtitle:r,children:(0,o.BX)(c.l.Root,{onSubmit:B,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$3}),children:[e,(0,o.tZ)(i.Y7,{fallback:(0,o.tZ)(x,{})}),(0,o.tZ)(n.Z.Alert,{children:g.error}),(0,o.tZ)(s.A,{isDisabled:!$,submitLabel:a??(0,h.localizationKeys)(`${b}.billingPage.paymentSourcesSection.formButtonPrimary__add`),onReset:y,hideReset:!y,sx:{flex:u?1:void 0}})]})})}},7106:function(e,t,r){r.d(t,{j:()=>n});var o=r(4328),i=r(4204),a=r(4174);let n=({paymentSource:e})=>(0,o.BX)(i.Flex,{sx:{overflow:"hidden"},gap:2,align:"baseline",elementDescriptor:i.descriptors.paymentSourceRow,children:[(0,o.tZ)(i.Icon,{icon:"card"===e.paymentMethod?a.aB:a.Nn,sx:e=>({alignSelf:"center",color:e.colors.$colorMutedForeground}),elementDescriptor:i.descriptors.paymentSourceRowIcon}),(0,o.tZ)(i.Text,{sx:e=>({color:e.colors.$colorForeground,textTransform:"capitalize"}),truncate:!0,elementDescriptor:i.descriptors.paymentSourceRowType,children:"card"===e.paymentMethod?e.cardType:e.paymentMethod}),(0,o.tZ)(i.Text,{sx:e=>({color:e.colors.$colorMutedForeground}),variant:"caption",truncate:!0,elementDescriptor:i.descriptors.paymentSourceRowValue,children:"card"===e.paymentMethod?`\u{22EF} ${e.last4}`:null}),e.isDefault&&(0,o.tZ)(i.Badge,{elementDescriptor:i.descriptors.paymentSourceRowBadge,elementId:i.descriptors.paymentSourceRowBadge.setId("default"),localizationKey:(0,i.localizationKeys)("badge__default")}),"expired"===e.status&&(0,o.tZ)(i.Badge,{elementDescriptor:i.descriptors.paymentSourceRowBadge,elementId:i.descriptors.paymentSourceRowBadge.setId("expired"),colorScheme:"danger",localizationKey:(0,i.localizationKeys)("badge__expired")})]})},5746:function(e,t,r){r.d(t,{u:()=>l});var o=r(4328),i=r(4204);let a={active:"badge__activePlan",upcoming:"badge__upcomingPlan",past_due:"badge__pastDuePlan",free_trial:"badge__freeTrial"},n={active:"secondary",upcoming:"primary",past_due:"warning",free_trial:"secondary"},l=({subscription:e,elementDescriptor:t})=>(0,o.tZ)(i.Badge,{elementDescriptor:t,colorScheme:n[e.status],localizationKey:(0,i.localizationKeys)(a[e.status])})},9140:function(e,t,r){r.d(t,{_:()=>S});var o=r(4328),i=r(3799),a=r(9144),n=r(2672),l=r(431),c=r(9460),s=r(8487),d=r(8870),u=r(6788),m=r(9281),p=r(1576),h=r(7703),f=r(207),y=r(4676),g=r(278),x=r(4204),b=r(6352);let Z=e=>{let{navigate:t}=(0,y.useRouter)(),{email:r,nextStep:i,onReset:l}=e,s=(0,n.useCardState)(),u=(0,p.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:m}=(0,b.eq)(r);async function h(){await t(r.verification.externalVerificationRedirectURL?.href||"")}return a.useEffect(()=>{let{mode:e,componentName:t}=u;m({redirectUrl:"modal"===e?(0,g.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>i()).catch(e=>(0,d.S3)(e,[],s.setError))},[]),(0,o.BX)(o.HY,{children:[(0,o.tZ)(x.Flex,{justify:"center",children:(0,o.tZ)(x.Button,{variant:"link",onClick:h,localizationKey:(0,x.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,o.tZ)(c.K,{children:(0,o.tZ)(x.Button,{variant:"ghost",localizationKey:(0,x.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:x.descriptors.formButtonReset,onClick:l})})]})};var $=r(2786);let S=(0,n.withCardStateProvider)(e=>{let{emailId:t,onSuccess:r,onReset:y,disableAutoFocus:g=!1}=e,x=(0,n.useCardState)(),{user:b}=(0,i.aF)(),S=(0,p.useEnvironment)(),w=(0,i.WZ)(e=>b?.createEmailAddress({email:e})),v=a.useRef(b?.emailAddresses.find(e=>e.id===t)),z=B(v.current,S),_=(0,m.a2)({defaultStep:+!!v.current,onNextStep:()=>x.setError(void 0)}),D=(0,u.Yp)("emailAddress","",{type:"email",label:(0,h.u1)("formFieldLabel__emailAddress"),placeholder:(0,h.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),C=D.value.length>1&&b?.username!==D.value,K=async e=>{if(e.preventDefault(),b)return w(D.value).then(e=>{v.current=e,_.nextStep()}).catch(e=>(0,d.S3)(e,[D],x.setError))},P=k(z);return(0,o.BX)(m.en,{..._.props,children:[(0,o.tZ)(s.Y,{headerTitle:e.title||(0,h.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,h.u1)("userProfile.emailAddressPage.formHint"),children:(0,o.BX)(l.l.Root,{onSubmit:K,children:[(0,o.tZ)(l.l.ControlRow,{elementId:D.id,children:(0,o.tZ)(l.l.PlainInput,{...D.props,autoFocus:!g})}),(0,o.tZ)(c.A,{submitLabel:(0,h.u1)("userProfile.formButtonPrimary__add"),isDisabled:!C,onReset:y})]})}),(0,o.BX)(s.Y,{headerTitle:(0,h.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,h.u1)(`${P}.formSubtitle`,{identifier:v.current?.emailAddress||""}),children:["email_link"===z&&(0,o.tZ)($.K,{nextStep:r,email:v.current,onReset:y}),"email_code"===z&&(0,o.tZ)(f.H,{nextStep:r,identification:v.current,identifier:v.current?.emailAddress,prepareVerification:()=>v.current?.prepareVerification({strategy:"email_code"}),onReset:y}),"enterprise_sso"===z&&(0,o.tZ)(Z,{nextStep:r,email:v.current,onReset:y})]})]})}),k=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error(`Unsupported strategy for email verification: ${e}`)}},B=(e,t)=>e?.matchesSsoConnection?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:r}=t.attributes;return!!(r?.enabled&&r?.verifications.includes("email_link"))}(t)?"email_code":"email_link"},207:function(e,t,r){r.d(t,{H:()=>u});var o=r(4328),i=r(9144),a=r(2667),n=r(2672),l=r(431),c=r(9460),s=r(8870),d=r(4204);let u=e=>{let t=(0,n.useCardState)(),{nextStep:r,identification:u,identifier:m,onReset:p,prepareVerification:h}=e,f=()=>h?.()?.catch(e=>(0,s.S3)(e,[],t.setError)),y=(0,a.e3)({onCodeEntryFinished:(e,t,r)=>{u?.attemptVerification({code:e}).then(()=>t()).catch(r)},onResendCodeClicked:f,onResolve:r});return i.useEffect(()=>{f()},[]),(0,o.BX)(o.HY,{children:[(0,o.tZ)(l.l.OTPInput,{...y,label:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:m||""}),resendButton:(0,d.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,o.BX)(c.K,{children:[(0,o.tZ)(d.Button,{isLoading:y.isLoading,localizationKey:(0,d.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:d.descriptors.formButtonPrimary,onClick:y.onFakeContinue}),(0,o.tZ)(d.Button,{variant:"ghost",isDisabled:y.isLoading,localizationKey:(0,d.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:d.descriptors.formButtonReset,onClick:p})]})]})}},2786:function(e,t,r){r.d(t,{K:()=>h,M:()=>f});var o=r(4328),i=r(9144),a=r(2672),n=r(9460),l=r(5495),c=r(8870),s=r(9281),d=r(6749),u=r(1576),m=r(4204),p=r(6352);let h=e=>{let{email:t,nextStep:r,onReset:s}=e,h=(0,a.useCardState)(),f=(0,u.useUserProfileContext)(),{startEmailLinkFlow:y}=(0,p.E2)(t),{displayConfig:g}=(0,u.useEnvironment)();function x(){let{routing:e}=f,t="virtual"===e?g.userProfileUrl:"";y({redirectUrl:(0,d.Uu)({ctx:f,baseUrl:t,intent:"profile"})}).then(()=>r()).catch(e=>(0,c.S3)(e,[],h.setError))}return i.useEffect(()=>{x()},[]),(0,o.BX)(o.HY,{children:[(0,o.tZ)(l.V,{resendButton:(0,m.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:x}),(0,o.tZ)(n.K,{children:(0,o.tZ)(m.Button,{variant:"ghost",localizationKey:(0,m.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:m.descriptors.formButtonReset,onClick:s})})]})},f=()=>(0,o.tZ)(s.Ej,{title:(0,m.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,m.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);